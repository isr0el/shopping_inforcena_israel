if (self.CavalryLogger) { CavalryLogger.start_js(["71lA0"]); }

__d("MercuryJewelCountControl",["Arbiter","CurrentUser","MercuryDispatcher","MercuryThreadInformer","MessengerState.bs","UserActivity"],(function(a,b,c,d,e,f){__p&&__p();function a(a){"use strict";__p&&__p();var c=b("MercuryDispatcher").get(),d=b("MercuryThreadInformer").get();this.render();c.subscribe("model-update-completed",function(a,b){this.$2(!1)}.bind(this));d.subscribe("unseen-updated",function(){return this.render()}.bind(this));d.subscribe("unread-updated",function(){return this.render()}.bind(this));this.$1=a;this.$1.subscribe("marked-seen",function(){this.$2(!0)}.bind(this))}a.prototype.render=function(){"use strict";var a=b("MessengerState.bs").getUnseenUnreadCount(b("CurrentUser").getID());b("Arbiter").inform("jewel/count-updated",{jewel:"mercurymessages",count:a},"state")};a.prototype.$2=function(a){"use strict";(a||this.$1.isOpen()&&b("UserActivity").isActive())&&b("MessengerState.bs").markAsSeen(b("CurrentUser").getID())};e.exports=a}),null);
__d("MessagesJewelThreadlistRowContainer.react",["ChatOpenTab","ChatOpenTabEventLogger","CurrentUser","FantaTabActions","ImmutableObject","MercuryIDs","MercuryThreadlistRowContainer.react","MessagesJewelThreadListRow.react","MessagingTag","MessengerDiscoveryEntryPoint","MessengerMessageRequestsTypedLogger","React","ReactComponentWithPureRenderMixin","TimeSlice"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=b("React").PropTypes;c=b("React").createClass({displayName:"MessagesJewelThreadlistRowContainer",mixins:[b("ReactComponentWithPureRenderMixin")],propTypes:{folder:a.string,readReceipts:a.any,thread:a.instanceOf(b("ImmutableObject")).isRequired,viewer:a.string.isRequired,handleChatTabOpen:a.func},render:function(){return b("React").createElement(b("MercuryThreadlistRowContainer.react"),{ChildClass:b("MessagesJewelThreadListRow.react"),onClick:this._handleClick,showPresence:b("ChatOpenTab").canOpenTab(),readReceipts:this.props.readReceipts,thread:this.props.thread,viewer:this.props.viewer})},_handleClick:function(a){__p&&__p();if(a.button===1||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)return;if(!b("ChatOpenTab").canOpenTab())return;this.props.handleChatTabOpen&&b("TimeSlice").guard(this.props.handleChatTabOpen,"Jewelupdate after Chat tab open",{propagationType:b("TimeSlice").PropagationType.ORPHAN})();a.preventDefault();a=this.props.thread.thread_id;var c=b("CurrentUser").getID();c=b("MercuryIDs").getThreadKeyfromThreadIDUserID(a,c);b("FantaTabActions").openTab(a,[b("MessengerDiscoveryEntryPoint").FB_HEADER_DOCK_JEWEL_THREAD]);b("ChatOpenTabEventLogger").logClickOpen("jewel",a);var d;switch(this.props.folder){case"inbox":d="inbox";break;case"pending":d="pending";break;case"other":d="other";break}this.props.thread.folder!==b("MessagingTag").INBOX&&new(b("MessengerMessageRequestsTypedLogger"))().setAction("message_requests_thread_open").setThreadID(b("MercuryIDs").getUserIDFromThreadID(a)).setSurface(d).setFolderType(this.props.thread.folder).setThreadKey(c).log()}});e.exports=c}),null);
__d("MessagesJewelThreadList.react",["cx","fbt","Arbiter","ChatConfig","CurrentUser","EventProfiler","ImmutableObject","Link.react","MessagesJewelThreadlistRowContainer.react","MessagingTag","MessengerMessageRequestsInfoReact.bs","MessengerState.bs","React","ScrollableArea.react","SubscriptionsHandler","TimeSlice","XUISpinner.react","debounce","getViewportDimensions","requestIdleCallback","requireWeak","throttle"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j=160,k=60,l=10;c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);i=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=i.constructor).call.apply(a,[this].concat(e)),this.$1=new(b("SubscriptionsHandler"))(),this.$4=function(){if(this.props.isLoaded||!this.refs.scrollable)return;var a=this.refs.scrollable.getArea();if(!a)return;a.getScrollTop()+a.getClientHeight()>=a.getScrollHeight()-1&&(this.props.onLoadMoreRequest&&this.props.onLoadMoreRequest())}.bind(this),this.$9=function(a){a.preventDefault(),this.props.onLoadMoreRequest&&this.props.onLoadMoreRequest()}.bind(this),this.$8=function(a){this.props.onFilteredRequestsClick&&this.props.onFilteredRequestsClick(a)}.bind(this),this.state={height:this.$3(),hasQP:!1},c}a.prototype.componentDidMount=function(){__p&&__p();this.$2=Event.listen(window,"resize",b("debounce")(function(){this.setState({height:this.$3()})}.bind(this)));b("EventProfiler").informManualInteractionTimestamp(["Messages_Jewel_Button"],!0,"click");var a=b("ChatConfig").get("message_jewel_promotion_data");a&&this.setState({hasQP:!0},function(){this.setState({height:this.$3()})}.bind(this));this.$1.addSubscriptions(b("Arbiter").subscribeOnce("hideMessageJewelQP",function(){this.setState({hasQP:!1},function(){this.setState({height:this.$3()})}.bind(this))}.bind(this)));a=function(){b("requestIdleCallback")(function(){b("requireWeak")("FantaTabsEagerBootloader",function(a){return a.bootload()})})};b("TimeSlice").guard(a,"JewelOpen fanta eagerbootloader",{propagationType:b("TimeSlice").PropagationType.ORPHAN})()};a.prototype.componentDidUpdate=function(a){a.threads.length===0&&this.props.threads.length!==0&&(this.props.onRenderThreads&&this.props.onRenderThreads()),b("EventProfiler").informManualInteractionTimestamp(["Messages_Jewel_Button"],!0,"click")};a.prototype.componentWillUnmount=function(){this.$2.remove(),this.$1.release()};a.prototype.render=function(){return b("React").createElement(b("MessengerState.bs").jsComponent,{fbid:b("CurrentUser").getID()},function(a){return b("React").createElement(b("ScrollableArea.react"),{className:"_2q3u",height:this.state.height,onScroll:b("throttle")(this.$4,50),ref:"scrollable"},b("React").createElement("ul",{className:"jewelContent"},this.$5(),this.props.threads.map(function(c){return this.$6(c,b("MessengerState.bs").pendingFolderUnseenCount(a),b("MessengerState.bs").readReceiptsPerThread(a))}.bind(this))),this.$7())}.bind(this))};a.prototype.$6=function(a,c,d){return b("React").createElement(b("MessagesJewelThreadlistRowContainer.react"),{folder:this.props.folder,key:a.thread_id,thread:a,viewer:this.props.viewer,handleChatTabOpen:this.props.handleChatTabOpen,readReceipts:d})};a.prototype.$3=function(){var a=(this.props.maxInitialThreadCount||l)*k-(this.state&&this.state.hasQP?260:0);return Math.min(a,b("getViewportDimensions")().height-j)};a.prototype.$7=function(){if(this.props.isLoaded)return this.props.folder===b("MessagingTag").PENDING?b("React").createElement("div",{className:"_16bh _16bi"},b("React").createElement(b("Link.react"),{onClick:this.$8},h._("Ver mensagens filtradas"))):null;return this.props.isLoading?b("React").createElement(b("XUISpinner.react"),{className:"jewelLoading"}):b("React").createElement("div",{className:"_v8y"},b("React").createElement(b("Link.react"),{href:"#",onClick:this.$9},h._("Mostrar mais antigas")))};a.prototype.$5=function(){return!this.props.jewelRequestsUI||this.props.folder!==b("MessagingTag").PENDING?null:b("React").createElement("li",{className:"_16bh _2ph_"},b("MessengerMessageRequestsInfoReact.bs").make())};a.propTypes={folder:c.string,isLoaded:c.bool,isLoading:c.bool,maxInitialThreadCount:c.number,jewelRequestsUI:c.bool,onFilteredRequestsClick:c.func,onLoadMoreRequest:c.func,onMessageRequestsClick:c.func,onRenderThreads:c.func,threads:c.arrayOf(c.oneOfType([c.instanceOf(b("ImmutableObject")),c.arrayOf(c.instanceOf(b("ImmutableObject")))])).isRequired,viewer:c.string.isRequired};e.exports=a}),null);
__d("MercuryJewelThreadlistControl",["csx","cx","fbt","ArbiterMixin","Bootloader","CSS","CurrentUser","DOM","Event","JSLogger","MercuryFilters.bs","MercuryServerRequests","MercuryThreadlistConstants","MercuryThreadlistContainer.react","MessagesJewelThreadList.react","MessagingTag","MessengerURIConstants","React","ReactDOM","gkx","mixin"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j,k=b("JSLogger").create("mercury_jewel"),l=b("MessagingTag").PENDING,m="back_to_inbox",n=i._("Ver tudo no Messenger"),o=i._("Ver tudo no Workplace Chat");c=babelHelpers.inherits(a,b("mixin")(b("ArbiterMixin")));j=c&&c.prototype;function a(a){"use strict";__p&&__p();j.constructor.call(this);this.$JewelThreadlistControl13=function(a){a.preventDefault(),this.$JewelThreadlistControl9(b("MessagingTag").PENDING,b("MercuryFilters.bs").all)}.bind(this);this.$JewelThreadlistControl14=function(a){a.preventDefault(),this.$JewelThreadlistControl9(b("MessagingTag").OTHER,b("MercuryFilters.bs").all)}.bind(this);a=a.getFlyout();this.$JewelThreadlistControl1=[];this.$JewelThreadlistControl2=b("DOM").find(a,"._3v_l");this.$JewelThreadlistControl3=b("MessagingTag").INBOX;this.$JewelThreadlistControl4=b("MercuryFilters.bs").all;this.$JewelThreadlistControl5=b("CurrentUser").getID();this.$JewelThreadlistControl6={};this.$JewelThreadlistControl7={};this.$JewelThreadlistControl6[b("MessagingTag").INBOX]=b("DOM").find(a,"._1sde");this.$JewelThreadlistControl7[b("MessagingTag").INBOX]=b("DOM").find(a,"._1sdg");this.$JewelThreadlistControl8=b("MercuryServerRequests").getForFBID(this.$JewelThreadlistControl5);b("Event").listen(this.$JewelThreadlistControl6[b("MessagingTag").INBOX],"click",function(){return this.$JewelThreadlistControl9(b("MessagingTag").INBOX,b("MercuryFilters.bs").all)}.bind(this));!b("gkx")("678596")?(this.$JewelThreadlistControl6[l]=b("DOM").find(a,"._1sdf"),this.$JewelThreadlistControl7[l]=b("DOM").find(a,"._1sdh"),b("Event").listen(this.$JewelThreadlistControl6[l],"click",function(){return this.$JewelThreadlistControl9(l,b("MercuryFilters.bs").all)}.bind(this))):(this.$JewelThreadlistControl6[m]=b("DOM").find(a,"._34zq"),b("Event").listen(this.$JewelThreadlistControl6[m],"click",function(){return this.$JewelThreadlistControl9(b("MessagingTag").INBOX,b("MercuryFilters.bs").all)}.bind(this)));this.$JewelThreadlistControl10=b("DOM").find(a,"._1c1m");this.$JewelThreadlistControl11=b("DOM").find(a,"._4djt");b("Event").listen(this.$JewelThreadlistControl10,"click",function(a){this.$JewelThreadlistControl12(),a.kill()}.bind(this));this.render();k.bump("opened_threadlist_"+this.$JewelThreadlistControl3)}a.prototype.render=function(){"use strict";b("Bootloader").loadModules(["MessengerState.bs","MercuryJewelUnreadCount.bs"],function(a,c){b("ReactDOM").render(b("React").createElement(a.jsComponent,{fbid:this.$JewelThreadlistControl5},function(c){return b("React").createElement(b("MercuryThreadlistContainer.react"),{ChildClass:b("MessagesJewelThreadList.react"),folder:this.$JewelThreadlistControl3,filter:this.$JewelThreadlistControl4,jewelRequestsUI:!b("gkx")("678596"),viewer:this.$JewelThreadlistControl5,onMessageRequestsClick:this.$JewelThreadlistControl13,onFilteredRequestsClick:this.$JewelThreadlistControl14,threadIDs:this.$JewelThreadlistControl1,threads:a.threads(c),threadlistOrderMap:a.threadlistOrderMap(c)})}.bind(this)),this.$JewelThreadlistControl2);var d=this.$JewelThreadlistControl7[b("MessagingTag").INBOX],e=this.$JewelThreadlistControl7[l];d&&b("ReactDOM").render(b("React").createElement(c.jsComponent,{viewer:this.$JewelThreadlistControl5,folder:b("MessagingTag").INBOX}),d);e&&b("ReactDOM").render(b("React").createElement(c.jsComponent,{viewer:this.$JewelThreadlistControl5,folder:l}),e)}.bind(this),"MercuryJewelThreadlistControl")};a.prototype.$JewelThreadlistControl12=function(){"use strict";this.$JewelThreadlistControl8.markFolderAsRead(this.$JewelThreadlistControl3)};a.prototype.$JewelThreadlistControl9=function(a,c){"use strict";__p&&__p();this.$JewelThreadlistControl1=[];if(this.$JewelThreadlistControl3!==a||this.$JewelThreadlistControl4!==c){var d=this.$JewelThreadlistControl3,e=a===b("MessagingTag").INBOX,f=a;k.bump("opened_threadlist_"+a);this.$JewelThreadlistControl6[f]&&b("CSS").addClass(this.$JewelThreadlistControl6[f],"_1sdd");this.$JewelThreadlistControl6[d]&&b("CSS").removeClass(this.$JewelThreadlistControl6[d],"_1sdd");f=b("CurrentUser").isWorkUser()?o:n;this.$JewelThreadlistControl3=a;this.$JewelThreadlistControl4=c;e?(this.$JewelThreadlistControl11.href=b("MessengerURIConstants").FACEBOOK_PREFIX,this.$JewelThreadlistControl11.text=f,this.$JewelThreadlistControl5=b("CurrentUser").getID()):a==l&&(this.$JewelThreadlistControl11.href=b("MessengerURIConstants").FACEBOOK_PREFIX+b("MessengerURIConstants").MESSAGE_REQUESTS_PATH,this.$JewelThreadlistControl11.text=f,this.$JewelThreadlistControl5=b("CurrentUser").getID());b("gkx")("678596")&&(b("CSS").conditionShow(this.$JewelThreadlistControl6[b("MessagingTag").INBOX],e),b("CSS").conditionShow(this.$JewelThreadlistControl6[m],!e));this.render()}};e.exports=a}),null);
__d("MercuryJewel",["Arbiter","EventProfiler","MercuryJewelCountControl","MercuryServerPayloadPreprocessor"],(function(a,b,c,d,e,f){__p&&__p();var g=!1,h=!1,i=null;function a(a,c){"use strict";b("MercuryServerPayloadPreprocessor").get().handleUpdate(c),this.$1=new(b("MercuryJewelCountControl"))(a),a.subscribeOnce("opened",function(){this.$2(a)}.bind(this)),a.subscribeOnce("user-open",function(){this.$3(a)}.bind(this)),a.subscribe("updated",function(b,c){c&&c.count>0&&this.$2(a)}.bind(this))}a.prototype.$2=function(a){"use strict";this.$3(a),g||(g=!0,a.isOpen()||(i=b("EventProfiler").notifyRunningEagerInteraction(["Messages_Jewel_Button"],"click")),d(["MercuryJewelThreadlistControl"],function(b){this.$4=new b(a)}.bind(this)),b("Arbiter").inform("mercury-jewel/opened",null,"state"))};a.prototype.$3=function(a){"use strict";!h&&a.isOpen()&&(h=!0,b("EventProfiler").tagCurrentActiveInteractionsAs("FirstMercuryJewelOpen"),i&&i())};e.exports=a}),null);
__d("MercuryJewelUnreadCount.bs",["fbt","bs_curry","ReasonReact.bs","bs_js_primitive","MessengerState.bs","MercuryThreadlistConstants"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("ReasonReact.bs").statelessComponent("MercuryJewelUnreadCount");function i(a,c,d){__p&&__p();return[h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],function(){__p&&__p();return b("ReasonReact.bs").element(undefined,undefined,b("bs_curry")._4(b("MessengerState.bs").Provider[0],undefined,undefined,b("bs_js_primitive").some(a),function(a){var d=a[16][c];d=d!==undefined?d.size:b("bs_js_primitive").undefined_to_opt(a[17][c]);if(d!==undefined){a=d;if(a===0)return null;else return g._("({unread_count})",[g._param("unread_count",String(a>b("MercuryThreadlistConstants").MAX_UNREAD_COUNT?b("MercuryThreadlistConstants").MAX_UNREAD_COUNT:a))])}else return null}))},h[9],h[10],h[11],h[12]]}a=b("ReasonReact.bs").wrapReasonForJs(h,function(a){return i(a.viewer,a.folder,[])});f.component=h;f.make=i;f.jsComponent=a}),null);